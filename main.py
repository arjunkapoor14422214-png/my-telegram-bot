import os
import time
import telebot
from telebot import types
from flask import Flask
import telebot.apihelper

# ╨Э╨░╤Б╤В╤А╨╛╨╣╨║╨╕ telebot: ╨┐╨╡╤А╨╕╨╛╨┤ ╨╢╨╕╨╖╨╜╨╕ ╤Б╨╡╤Б╤Б╨╕╨╕ (╤Г╨╝╨╡╨╜╤М╤И╨░╨╡╤В ╤И╨░╨╜╤Б╤Л ╨╜╨░ ConnectionError)
telebot.apihelper.SESSION_TIME_TO_LIVE = 5

# Flask app (╨╛╨┤╨╕╨╜ ╤Н╨║╨╖╨╡╨╝╨┐╨╗╤П╤А)
app = Flask(__name__)

@app.route('/')
def index():
    return '╨С╨╛╤В ╤А╨░╨▒╨╛╤В╨░╨╡╤В!'

# ╨С╨╡╤А╤С╨╝ ╤В╨╛╨║╨╡╨╜ ╨╕╨╖ ╨┐╨╡╤А╨╡╨╝╨╡╨╜╨╜╤Л╤Е ╨╛╨║╤А╤Г╨╢╨╡╨╜╨╕╤П
BOT_TOKEN = os.getenv("BOT_TOKEN")
if not BOT_TOKEN:
    raise ValueError("╨Ю╤И╨╕╨▒╨║╨░: ╨┐╨╡╤А╨╡╨╝╨╡╨╜╨╜╨░╤П ╨╛╨║╤А╤Г╨╢╨╡╨╜╨╕╤П BOT_TOKEN ╨╜╨╡ ╨╖╨░╨┤╨░╨╜╨░!")

# ╨Ш╨╜╨╕╤Ж╨╕╨░╨╗╨╕╨╖╨░╤Ж╨╕╤П ╨▒╨╛╤В╨░
bot = telebot.TeleBot(BOT_TOKEN)

# ╨б╨╗╨╛╨▓╨░╤А╤М ╨┤╨╗╤П ╤Е╤А╨░╨╜╨╡╨╜╨╕╤П ╨▓╤Л╨▒╤А╨░╨╜╨╜╨╛╨│╨╛ ╤П╨╖╤Л╨║╨░ ╨┐╨╛╨╗╤М╨╖╨╛╨▓╨░╤В╨╡╨╗╤П╨╝╨╕ (╨▓ ╨┐╨░╨╝╤П╤В╨╕)
user_language = {}


LANGS = {
    "EN": "ЁЯЗмЁЯЗз English",
    "RU": "ЁЯЗ╖ЁЯЗ║ ╨а╤Г╤Б╤Б╨║╨╕╨╣",
    "AR": "ЁЯЗ╕ЁЯЗж ╪з┘Д╪╣╪▒╪и┘К╪й",
    "HI": "ЁЯЗоЁЯЗ│ рд╣рд┐рдВрджреА",
    "BN": "ЁЯЗзЁЯЗй ржмрж╛ржВрж▓рж╛"
}

# ╨в╨╡╨║╤Б╤В╤Л
TEXTS = {
    "start": {
        "EN": "Welcome! Please choose your language ЁЯМР",
        "RU": "╨Ф╨╛╨▒╤А╨╛ ╨┐╨╛╨╢╨░╨╗╨╛╨▓╨░╤В╤М! ╨Я╨╛╨╢╨░╨╗╤Г╨╣╤Б╤В╨░, ╨▓╤Л╨▒╨╡╤А╨╕╤В╨╡ ╤П╨╖╤Л╨║ ЁЯМР",
        "AR": "┘Е╪▒╪н╪и┘Л╪з! ┘К╪▒╪м┘Й ╪з╪о╪к┘К╪з╪▒ ┘Д╪║╪к┘Г ЁЯМР",
        "HI": "рд╕реНрд╡рд╛рдЧрдд рд╣реИ! рдХреГрдкрдпрд╛ рдЕрдкрдиреА рднрд╛рд╖рд╛ рдЪреБрдиреЗрдВ ЁЯМР",
        "BN": "рж╕рзНржмрж╛ржЧрждржо! ржЖржкржирж╛рж░ ржнрж╛рж╖рж╛ ржирж┐рж░рзНржмрж╛ржЪржи ржХрж░рзБржи ЁЯМР",
    },
    "menu": {
        "EN": "Please choose an option:",
        "RU": "╨Я╨╛╨╢╨░╨╗╤Г╨╣╤Б╤В╨░, ╨▓╤Л╨▒╨╡╤А╨╕╤В╨╡ ╨┤╨╡╨╣╤Б╤В╨▓╨╕╨╡:",
        "AR": "┘К╪▒╪м┘Й ╪з╪о╪к┘К╪з╪▒ ╪о┘К╪з╪▒:",
        "HI": "рдХреГрдкрдпрд╛ рд╡рд┐рдХрд▓реНрдк рдЪреБрдиреЗрдВ:",
        "BN": "ржЕржирзБржЧрзНрж░рж╣ ржХрж░рзЗ ржПржХржЯрж┐ ржмрж┐ржХрж▓рзНржк ржирж┐рж░рзНржмрж╛ржЪржи ржХрж░рзБржи:",
    },
    "partner": {
        "EN": "Create your account using the LINKKKKKKKKKK your email to your manager, or if you don't have one, contact our head manager for further assistance.\n\nTelegram: 
        "RU": "╨б╨╛╨╖╨┤╨░╨╣╤В╨╡ ╤Б╨▓╨╛╨╣ ╨░╨║╨║╨░╤Г╨╜╤В ╨┐╨╛ ╤Б╤Б╤Л╨╗╨║╨╡
        "HI": "рдЗрд╕ рд▓рд┐рдВрдХ рд╕реЗ рдЕрдкрдирд╛ рдЕрдХрд╛рдЙрдВрдЯ рдмрдирд╛рдПрдВ:
        "BN": "ржПржЗ рж▓рж┐ржЩрзНржХ ржжрж┐ржпрж╝рзЗ ржЖржкржирж╛рж░ ржЕрзНржпрж╛ржХрж╛ржЙржирзНржЯ рждрзИрж░рж┐ ржХрж░рзБржи
    },
    "agent_choose": {
        "EN": "Choose agent type:",
        "RU": "╨Т╤Л╨▒╨╡╤А╨╕╤В╨╡ ╤В╨╕╨┐ ╨░╨│╨╡╨╜╤В╨░:",
        "AR": "╪з╪о╪к╪▒ ┘Ж┘И╪╣ ╪з┘Д┘И┘Г┘К┘Д:",
        "HI": "рдПрдЬреЗрдВрдЯ рдкреНрд░рдХрд╛рд░ рдЪреБрдиреЗрдВ:",
        "BN": "ржПржЬрзЗржирзНржЯрзЗрж░ ржзрж░ржи ржирж┐рж░рзНржмрж╛ржЪржи ржХрж░рзБржи:",
    },
    "agent_bank": {
        "EN": """Please provide the following information:

1. Full name:
2. Date of birth:
3. NID number:
4. Current location:
5. Wallets (geos) for payments:
6. Weekly volumes through bank:
7. Ready for advance payment in two parts:
8. Ensure 24/7 availability:
9. Attach NID photos and selfie.

Send this information to: @,
        "RU": """╨Я╨╛╨╢╨░╨╗╤Г╨╣╤Б╤В╨░, ╨┐╤А╨╡╨┤╨╛╤Б╤В╨░╨▓╤М╤В╨╡ ╤Б╨╗╨╡╨┤╤Г╤О╤Й╤Г╤О ╨╕╨╜╤Д╨╛╤А╨╝╨░╤Ж╨╕╤О:

1. ╨д╨Ш╨Ю:
2. ╨Ф╨░╤В╨░ ╤А╨╛╨╢╨┤╨╡╨╜╨╕╤П:
3. ╨Э╨╛╨╝╨╡╤А NID:
4. ╨в╨╡╨║╤Г╤Й╨╡╨╡ ╨╝╨╡╤Б╤В╨╛╨┐╨╛╨╗╨╛╨╢╨╡╨╜╨╕╨╡:
5. ╨Ъ╨╛╤И╨╡╨╗╤М╨║╨╕ ╨┤╨╗╤П ╨┐╨╗╨░╤В╨╡╨╢╨╡╨╣:
6. ╨Х╨╢╨╡╨╜╨╡╨┤╨╡╨╗╤М╨╜╤Л╨╡ ╨╛╨▒╤К╨╡╨╝╤Л ╤З╨╡╤А╨╡╨╖ ╨▒╨░╨╜╨║:
7. ╨У╨╛╤В╨╛╨▓╤Л ╤Б╨┤╨╡╨╗╨░╤В╤М ╨┐╤А╨╡╨┤╨╛╨┐╨╗╨░╤В╤Г ╨▓ ╨┤╨▓╨░ ╤Н╤В╨░╨┐╨░:
8. ╨Ю╨▒╨╡╤Б╨┐╨╡╤З╨╕╤В╨╡ ╨┤╨╛╤Б╤В╤Г╨┐╨╜╨╛╤Б╤В╤М 24/7:
9. ╨Я╤А╨╕╨║╤А╨╡╨┐╨╕╤В╨╡ ╤Д╨╛╤В╨╛ NID ╨╕ ╤Б╨╡╨╗╤Д╨╕.

╨Ю╤В╨┐╤А╨░╨▓╤М╤В╨╡ ╤Н╤В╤Г ╨╕╨╜╤Д╨╛╤А╨╝╨░╤Ж╨╕╤О: @,
        "AR": """┘К╪▒╪м┘Й ╪к┘В╪п┘К┘Е ╪з┘Д┘Е╪╣┘Д┘И┘Е╪з╪к ╪з┘Д╪к╪з┘Д┘К╪й:

1. ╪з┘Д╪з╪│┘Е ╪з┘Д┘Г╪з┘Е┘Д:
2. ╪к╪з╪▒┘К╪о ╪з┘Д┘Е┘К┘Д╪з╪п:
3. ╪▒┘В┘Е ╪з┘Д┘З┘И┘К╪й:
4. ╪з┘Д┘Е┘И┘В╪╣ ╪з┘Д╪н╪з┘Д┘К:
5. ╪з┘Д┘Е╪н╪з┘Б╪╕ ┘Д┘Д┘Е╪п┘Б┘И╪╣╪з╪к:
6. ╪з┘Д╪г╪н╪м╪з┘Е ╪з┘Д╪г╪│╪и┘И╪╣┘К╪й ╪╣╪и╪▒ ╪з┘Д╪и┘Ж┘Г:
7. ┘З┘Д ╪г┘Ж╪к ┘Е╪│╪к╪╣╪п ┘Д┘Д╪п┘Б╪╣ ╪з┘Д┘Е╪│╪и┘В ╪╣┘Д┘Й ╪м╪▓╪г┘К┘Ж:
8. ╪╢┘Е╪з┘Ж ╪з┘Д╪к┘И┘Б╪▒ 24/7:
9. ╪г╪▒┘Б┘В ╪╡┘И╪▒ ╪з┘Д┘З┘И┘К╪й ┘И╪╡┘И╪▒╪й ╪┤╪о╪╡┘К╪й.

╪г╪▒╪│┘Д ┘З╪░┘З ╪з┘Д┘Е╪╣┘Д┘И┘Е╪з╪к ╪е┘Д┘Й: @""",
        "HI": """рдХреГрдкрдпрд╛ рдирд┐рдореНрди рдЬрд╛рдирдХрд╛рд░реА рджреЗрдВ:

1. рдкреВрд░рд╛ рдирд╛рдо:
2. рдЬрдиреНрдо рддрд┐рдерд┐:
3. NID рдирдВрдмрд░:
4. рд╡рд░реНрддрдорд╛рди рд╕реНрдерд╛рди:
5. рднреБрдЧрддрд╛рди рдХреЗ рд▓рд┐рдП рд╡реЙрд▓реЗрдЯреНрд╕:
6. рдмреИрдВрдХ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╕рд╛рдкреНрддрд╛рд╣рд┐рдХ рд╡реЙрд▓реНрдпреВрдо:
7. рджреЛ рд╣рд┐рд╕реНрд╕реЛрдВ рдореЗрдВ рдЕрдЧреНрд░рд┐рдо рднреБрдЧрддрд╛рди рдХреЗ рд▓рд┐рдП рддреИрдпрд╛рд░:
8. 24/7 рдЙрдкрд▓рдмреНрдзрддрд╛ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░реЗрдВ:
9. NID рдлреЛрдЯреЛ рдФрд░ рд╕реЗрд▓реНрдлреА рд╕рдВрд▓рдЧреНрди рдХрд░реЗрдВред

рдпрд╣ рдЬрд╛рдирдХрд╛рд░реА рднреЗрдЬреЗрдВ: @"",
        "BN": """ржЕржирзБржЧрзНрж░рж╣ ржХрж░рзЗ ржирж┐ржорзНржирж▓рж┐ржЦрж┐ржд рждржерзНржп ржкрзНрж░ржжрж╛ржи ржХрж░рзБржи:

1. ржкрзБрж░рзЛ ржирж╛ржо:
2. ржЬржирзНржо рждрж╛рж░рж┐ржЦ:
3. NID ржиржорзНржмрж░:
4. ржмрж░рзНрждржорж╛ржи ржЕржмрж╕рзНржерж╛ржи:
5. ржкрзЗржорзЗржирзНржЯрзЗрж░ ржЬржирзНржп ржУржпрж╝рж╛рж▓рзЗржЯ:
6. ржмрзНржпрж╛ржВржХрзЗрж░ ржорж╛ржзрзНржпржорзЗ рж╕рж╛ржкрзНрждрж╛рж╣рж┐ржХ ржнрж▓рж┐ржЙржо:
7. ржжрзБржЗ ржЕржВрж╢рзЗ ржЕржЧрзНрж░рж┐ржо ржкрзНрж░ржжрж╛ржирзЗрж░ ржЬржирзНржп ржкрзНрж░рж╕рзНрждрзБржд:
8. 24/7 ржЙржкрж▓ржмрзНржзрждрж╛ ржирж┐рж╢рзНржЪрж┐ржд ржХрж░рзБржи:
9. NID ржЫржмрж┐ ржПржмржВ рж╕рзЗрж▓ржлрж┐ рж╕ржВржпрзБржХрзНржд ржХрж░рзБржиред

ржПржЗ рждржерзНржп ржкрж╛ржарж╛ржи: @"""
    },
    "agent_mobcash": {
        "EN": "Hello! Fill out the form to create MobCash account. Then send your account ID to your manager or main manager.\nTelegram: @",
        "RU": "╨Ч╨┤╤А╨░╨▓╤Б╤В╨▓╤Г╨╣╤В╨╡! ╨Ч╨░╨┐╨╛╨╗╨╜╨╕╤В╨╡ ╤Д╨╛╤А╨╝╤Г ╨┤╨╗╤П ╤Б╨╛╨╖╨┤╨░╨╜╨╕╤П MobCash ╨░╨║╨║╨░╤Г╨╜╤В╨░. ╨Ч╨░╤В╨╡╨╝ ╨╛╤В╨┐╤А╨░╨▓╤М╤В╨╡ ID ╨░╨║╨║╨░╤Г╨╜╤В╨░ ╨▓╨░╤И╨╡╨╝╤Г ╨╝╨╡╨╜╨╡╨┤╨╢╨╡╤А╤Г ╨╕╨╗╨╕ ╨│╨╗╨░╨▓╨╜╨╛╨╝╤Г ╨╝╨╡╨╜╨╡╨┤╨╢╨╡╤А╤Г.\nTelegram: @",
        "AR": "┘Е╪▒╪н╪и┘Л╪з! ╪з┘Е┘Д╪г ╪з┘Д┘Ж┘Е┘И╪░╪м ┘Д╪е┘Ж╪┤╪з╪б ╪н╪│╪з╪и MobCash. ╪л┘Е ╪г╪▒╪│┘Д ┘Е╪╣╪▒┘Б ╪з┘Д╪н╪│╪з╪и ╪е┘Д┘Й ┘Е╪п┘К╪▒┘Г ╪г┘И ╪з┘Д┘Е╪п┘К╪▒ ╪з┘Д╪▒╪ж┘К╪│┘К.\nTelegram: @",
        "HI": "рдирдорд╕реНрддреЗ! MobCash рдЕрдХрд╛рдЙрдВрдЯ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдлреЙрд░реНрдо рднрд░реЗрдВред рдлрд┐рд░ рдЕрдкрдирд╛ рдЕрдХрд╛рдЙрдВрдЯ ID рдЕрдкрдиреЗ рдореИрдиреЗрдЬрд░ рдпрд╛ рдореБрдЦреНрдп рдореИрдиреЗрдЬрд░ рдХреЛ рднреЗрдЬреЗрдВред\nTelegram: @",
        "BN": "рж╣рзНржпрж╛рж▓рзЛ! MobCash ржЕрзНржпрж╛ржХрж╛ржЙржирзНржЯ рждрзИрж░рж┐ ржХрж░рждрзЗ ржлрж░рзНржо ржкрзВрж░ржг ржХрж░рзБржиред рждрж╛рж░ржкрж░ ржЖржкржирж╛рж░ ржЕрзНржпрж╛ржХрж╛ржЙржирзНржЯ ID ржЖржкржирж╛рж░ ржорзНржпрж╛ржирзЗржЬрж╛рж░ ржмрж╛ ржкрзНрж░ржзрж╛ржи ржорзНржпрж╛ржирзЗржЬрж╛рж░рзЗрж░ ржХрж╛ржЫрзЗ ржкрж╛ржарж╛ржиред\nTelegram: @"
    },
    "support": {
        "EN": "Support contacts:
        "RU": "╨Ъ╨╛╨╜╤В╨░╨║╤В╤Л ╨┐╨╛╨┤╨┤╨╡╤А╨╢╨║╨╕:
        "AR": "╪п╪╣┘Е ╪з┘Д╪╣┘Е┘Д╪з╪б:
        "HI": "рд╕рдкреЛрд░реНрдЯ рд╕рдВрдкрд░реНрдХ:
        "BN": "рж╕рж╛ржкрзЛрж░рзНржЯ ржпрзЛржЧрж╛ржпрзЛржЧ:
    },
    "verify": {
        "EN": "Enter manager username in format @USERNAME:",
        "RU": "╨Т╨▓╨╡╨┤╨╕╤В╨╡ ╨╕╨╝╤П ╨╝╨╡╨╜╨╡╨┤╨╢╨╡╤А╨░ ╨▓ ╤Д╨╛╤А╨╝╨░╤В╨╡ @USERNAME:",
        "AR": "╪г╪п╪о┘Д ╪з╪│┘Е ╪з┘Д┘Е╪п┘К╪▒ ╪и╪к┘Ж╪│┘К┘В @USERNAME:",
        "HI": "@USERNAME рдлреЙрд░реНрдореЗрдЯ рдореЗрдВ рдореИрдиреЗрдЬрд░ рдХрд╛ рдирд╛рдо рджрд░реНрдЬ рдХрд░реЗрдВ:",
        "BN": "@USERNAME ржлрж░ржорзНржпрж╛ржЯрзЗ ржорзНржпрж╛ржирзЗржЬрж╛рж░рзЗрж░ ржЗржЙржЬрж╛рж░ржирзЗржо рж▓рж┐ржЦрзБржи:",
    },
    "valid": {
        "EN": "тЬЕ This is our official manager. You can trust them.",
        "RU": "тЬЕ ╨н╤В╨╛ ╨╜╨░╤И ╨╝╨╡╨╜╨╡╨┤╨╢╨╡╤А, ╨▓╤Л ╨╝╨╛╨╢╨╡╤В╨╡ ╨╡╨╝╤Г ╨┤╨╛╨▓╨╡╤А╤П╤В╤М.",
        "AR": "тЬЕ ┘З╪░╪з ┘Е╪п┘К╪▒ ╪▒╪│┘Е┘К. ┘К┘Е┘Г┘Ж┘Г ╪з┘Д┘И╪л┘И┘В ╪и┘З.",
        "HI": "тЬЕ рдпрд╣ рд╣рдорд╛рд░рд╛ рдЖрдзрд┐рдХрд╛рд░рд┐рдХ рдореИрдиреЗрдЬрд░ рд╣реИред рдЖрдк рдЙрди рдкрд░ рднрд░реЛрд╕рд╛ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред",
        "BN": "тЬЕ ржПржЯрж┐ ржЖржорж╛ржжрзЗрж░ ржЕржлрж┐рж╕рж┐ржпрж╝рж╛рж▓ ржорзНржпрж╛ржирзЗржЬрж╛рж░ред ржЖржкржирж┐ рждрж╛ржХрзЗ ржмрж┐рж╢рзНржмрж╛рж╕ ржХрж░рждрзЗ ржкрж╛рж░рзЗржиред",
    },
    "invalid": {
        "EN": "тЫФя╕П This is not our manager. Contact @",
        "RU": "тЫФя╕П ╨н╤В╨╛ ╨╜╨╡ ╨╜╨░╤И ╨╝╨╡╨╜╨╡╨┤╨╢╨╡╤А. ╨б╨▓╤П╨╢╨╕╤В╨╡╤Б╤М ╤Б @",
        "AR": "тЫФя╕П ┘З╪░╪з ┘Д┘К╪│ ┘Е╪п┘К╪▒┘Ж╪з. ╪з╪к╪╡┘Д ╪и┘А @",
        "HI": "тЫФя╕П рдпрд╣ рд╣рдорд╛рд░рд╛ рдореИрдиреЗрдЬрд░ рдирд╣реАрдВ рд╣реИред @ рд╕реЗ рд╕рдВрдкрд░реНрдХ рдХрд░реЗрдВ",
        "BN": "тЫФя╕П ржПржЯрж┐ ржЖржорж╛ржжрзЗрж░ ржорзНржпрж╛ржирзЗржЬрж╛рж░ ржиржпрж╝ред ржпрзЛржЧрж╛ржпрзЛржЧ ржХрж░рзБржи @",
    }
}

valid_managers = ["@", "@", "@"]

def get_lang(chat_id):
    return user_language.get(chat_id, "EN")

def main_menu(chat_id):
    lang = get_lang(chat_id)

    markup = types.ReplyKeyboardMarkup(resize_keyboard=True)
    markup.add(
        "тЬЕ " + ("Become Partner" if lang=="EN" else TEXTS["partner"][lang][:20]+"..."),
        "ЁЯТ╕ " + ("Be Payment Agent" if lang=="EN" else TEXTS["agent_choose"][lang])
    )
    markup.add(
        "ЁЯУЮ " + ("Support" if lang=="EN" else TEXTS["support"][lang][:20]+"..."),
        "ЁЯХ╡я╕П " + ("Verify Manager" if lang=="EN" else TEXTS["verify"][lang][:20]+"...")
    )
    markup.add("ЁЯМР " + ("Change Language" if lang=="EN" else TEXTS["start"][lang][:20]+"..."))

    bot.send_message(chat_id, TEXTS["menu"][lang], reply_markup=markup)

@bot.message_handler(commands=['start'])
def start(msg):
    markup = types.ReplyKeyboardMarkup(resize_keyboard=True)
    for code, name in LANGS.items():
        markup.add(name)
    bot.send_message(msg.chat.id, TEXTS["start"]["EN"], reply_markup=markup)

@bot.message_handler(func=lambda m: m.text in LANGS.values())
def set_language(msg):
    lang_code = [k for k,v in LANGS.items() if v == msg.text][0]
    user_language[msg.chat.id] = lang_code
    main_menu(msg.chat.id)

@bot.message_handler(func=lambda m: True)
def menu_handler(msg):
    chat_id = msg.chat.id
    lang = get_lang(chat_id)
    t = msg.text

    if "тЬЕ" in t: 
        bot.send_message(chat_id, TEXTS["partner"][lang])
        return
    if "ЁЯТ╕" in t:
        markup = types.ReplyKeyboardMarkup(resize_keyboard=True)
        markup.add("ЁЯПж Bank-transfer", "ЁЯУ▒ MobCash")
        markup.add("тмЕя╕П Back")
        bot.send_message(chat_id, TEXTS["agent_choose"][lang], reply_markup=markup)
        return
    if "ЁЯУЮ" in t: 
        bot.send_message(chat_id, TEXTS["support"][lang])
        return
    if "ЁЯХ╡я╕П" in t: 
        bot.send_message(chat_id, TEXTS["verify"][lang])
        return
    if "ЁЯМР" in t:
        markup = types.ReplyKeyboardMarkup(resize_keyboard=True)
        for code, name in LANGS.items(): 
            markup.add(name)
        bot.send_message(chat_id, TEXTS["start"][lang], reply_markup=markup)
        return
    if "ЁЯПж" in t: 
        bot.send_message(chat_id, TEXTS["agent_bank"][lang])
        return
    if "ЁЯУ▒" in t: 
        bot.send_message(chat_id, TEXTS["agent_mobcash"][lang])
        return
    if "тмЕя╕П" in t:
        main_menu(chat_id)
        return
    if t.startswith("@"):
        if t in valid_managers: 
            bot.send_message(chat_id, TEXTS["valid"][lang])
        else: 
            bot.send_message(chat_id, TEXTS["invalid"][lang])
        main_menu(chat_id)
        return

# Flask "keep-alive" ╨┤╨╗╤П Render (╤Н╨╜╨┤╨┐╨╛╨╕╨╜╤В ╨╖╨┤╨╛╤А╨╛╨▓╤М╤П)
@app.route('/health')
def health():
    return "ok"

# ╨Ч╨░╨┐╤Г╤Б╨║ polling (╤В╨╛╨╗╤М╨║╨╛ ╨┐╤А╨╕ ╨╖╨░╨┐╤Г╤Б╨║╨╡ ╤З╨╡╤А╨╡╨╖ python main.py)
if __name__ == "__main__":
    print("тЬЕ ╨С╨╛╤В ╨╖╨░╨┐╤Г╤Б╨║╨░╨╡╤В╤Б╤П (polling)...")
    # ╨С╨╡╤Б╨║╨╛╨╜╨╡╤З╨╜╤Л╨╣ ╤Ж╨╕╨║╨╗ ╤Б ╨░╨▓╤В╨╛-╨┐╨╡╤А╨╡╨┐╨╛╨┤╨║╨╗╤О╤З╨╡╨╜╨╕╨╡╨╝ ╨┐╤А╨╕ ╨╛╤И╨╕╨▒╨║╨░╤Е ╤Б╨╡╤В╨╕
    while True:
        try:
            bot.infinity_polling(skip_pending=True, timeout=10, long_polling_timeout=5)
        except Exception as e:
            print(f"тЪая╕П ╨Ю╤И╨╕╨▒╨║╨░ ╤Б╨╛╨╡╨┤╨╕╨╜╨╡╨╜╨╕╤П: {e}. ╨Я╨╡╤А╨╡╨┐╨╛╨┤╨║╨╗╤О╤З╨░╨╡╨╝╤Б╤П ╤З╨╡╤А╨╡╨╖ 5s...")
            time.sleep(5)
